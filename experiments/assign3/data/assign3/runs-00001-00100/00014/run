#! /usr/bin/env python

import logging
import os
import platform

from lab.calls.call import Call
from lab import tools

tools.configure_logging()

logging.info(f"node: {platform.node()}")

run_log = open("run.log", "w")
run_err = open("run.err", "w", buffering=1)  # line buffering
redirects = {"stdout": run_log, "stderr": run_err}

# Make sure we're in the run directory.
os.chdir(os.path.dirname(os.path.abspath(__file__)))

Call(['/home/dawson/Documents/Masters/Thesis/search/code/downward-projects/downward/experiments/assign3/.venv/bin/python3', '../../code-c23fe3eeb7e93b9aa5094cd2d969854439c7c5bc_e5e41175/fast-downward.py', '--validate', '--overall-time-limit', '30m', '--overall-memory-limit', '3584M', '--overall-time-limit', '5m', 'domain.pddl', 'problem.pddl', '--search', '--if-unit-cost', 'let(hlm, landmark_sum(lm_reasonable_orders_hps(lm_rhw()),pref=true),let(hff, ff(), lazy_greedy([hff,hlm],preferred=[hff,hlm])))', '--if-non-unit-cost', 'let(hlm1, landmark_sum(lm_reasonable_orders_hps(lm_rhw()),transform=adapt_costs(one),pref=true),let(hff1, ff(transform=adapt_costs(one)),let(hlm2, landmark_sum(lm_reasonable_orders_hps(lm_rhw()),transform=adapt_costs(plusone),pref=true),lazy_greedy([hff1,hlm1],preferred=[hff1,hlm1], cost_type=one,reopen_closed=false))))'], hard_stderr_limit=10240, hard_stdout_limit=10240, memory_limit=None, name='planner', soft_stderr_limit=64, soft_stdout_limit=1024, time_limit=None, **redirects).wait()

Call(['/home/dawson/Documents/Masters/Thesis/search/code/downward-projects/downward/experiments/assign3/.venv/bin/python3', '../../exitcode-parser.py'], hard_stderr_limit=10240, hard_stdout_limit=10240, memory_limit=None, name='exitcode_parser', soft_stderr_limit=64, soft_stdout_limit=1024, time_limit=None, **redirects).wait()

Call(['/home/dawson/Documents/Masters/Thesis/search/code/downward-projects/downward/experiments/assign3/.venv/bin/python3', '../../translator-parser.py'], hard_stderr_limit=10240, hard_stdout_limit=10240, memory_limit=None, name='translator_parser', soft_stderr_limit=64, soft_stdout_limit=1024, time_limit=None, **redirects).wait()

Call(['/home/dawson/Documents/Masters/Thesis/search/code/downward-projects/downward/experiments/assign3/.venv/bin/python3', '../../single-search-parser.py'], hard_stderr_limit=10240, hard_stdout_limit=10240, memory_limit=None, name='single_search_parser', soft_stderr_limit=64, soft_stdout_limit=1024, time_limit=None, **redirects).wait()

Call(['/home/dawson/Documents/Masters/Thesis/search/code/downward-projects/downward/experiments/assign3/.venv/bin/python3', '../../parser.py'], hard_stderr_limit=10240, hard_stdout_limit=10240, memory_limit=None, name='parser', soft_stderr_limit=64, soft_stdout_limit=1024, time_limit=None, **redirects).wait()

Call(['/home/dawson/Documents/Masters/Thesis/search/code/downward-projects/downward/experiments/assign3/.venv/bin/python3', '../../planner-parser.py'], hard_stderr_limit=10240, hard_stdout_limit=10240, memory_limit=None, name='planner_parser', soft_stderr_limit=64, soft_stdout_limit=1024, time_limit=None, **redirects).wait()


for f in [run_log, run_err]:
    f.close()
    if os.path.getsize(f.name) == 0:
        os.remove(f.name)
